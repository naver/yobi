@(project:Project, menuType:utils.MenuType, menuCSS:String)

@import utils._
@import models.enumeration.ResourceType;
@import utils.TemplateHelper._
@import utils.AccessControl._

@isActiveMenu(m_type:MenuType) = @{
    if (m_type == menuType) {"active"}
}

@makeSubMenu(call:Call, name:String) = {
	<li class="@isActiveSubMenu(call)"><a href="@call">@name</a></li>
}

@isActiveSubMenu(calls: Call*) = @{
    var menuState = ""
    for(call <- calls) {
        if(call.toString().equals(request().path().toString())) {
            menuState = "active"
        }
    }
    menuState
}

@getPullRequestURL(project:Project) = @{
    if(project.isFork()){
        routes.PullRequestApp.sentPullRequests(project.owner, project.name)
    } else {
        routes.PullRequestApp.pullRequests(project.owner, project.name)
    }
}

<div class="project-menu">
    <div class="actrow">
        @if(project.isFork()){
        <div class="label forked-from">
            <i class="icon-random icon-white"></i>
            &nbsp;@Messages("fork.original")
            <span class="gray">/ <a href="@routes.UserApp.userInfo(project.originalProject.owner)">@project.originalProject.owner</a> / </span>
            <a href="@routes.ProjectApp.project(project.originalProject.owner, project.originalProject.name)">@project.originalProject.name</a>
        </div>
        }
        
        @if(User.isWatching(project)){
        <a href="@routes.WatchProjectApp.unwatch(project.owner, project.name)" class="nbtn medium orange watchBtn"><i class="icon-star icon-white" style="vertical-align:bottom;"></i></a>
        } else {
        <a href="@routes.WatchProjectApp.watch(project.owner, project.name)" class="nbtn medium watchBtn"><i class="icon-star-empty icon-white" style="vertical-align:bottom;"></i></a>
        }
    </div>

	<div class="project-menu-wrap main">
		<ul class="unstyled">
			<li class="@isActiveMenu(MenuType.PROJECT_HOME)"><a href="@routes.ProjectApp.project(project.owner, project.name)">@Messages("title.projectHome")</a></li>
			<li class="sp-line">|</li>
			<li class="@isActiveMenu(MenuType.BOARD)"><a href="@routes.BoardApp.posts(project.owner, project.name)">@Messages("menu.board")</a></li>
			<li class="sp-line">|</li>
			<li class="@isActiveMenu(MenuType.CODE)"><a href="@routes.CodeApp.codeBrowser(project.owner, project.name)">@Messages("menu.code")</a></li>
            @if(project.vcs.equals("GIT")){
                <li class="sp-line">|</li>
                <li class="@isActiveMenu(MenuType.PULL_REQUEST)">
                    <a href="@getPullRequestURL(project)">@Messages("menu.pullRequest")</a>
                </li>
            }
			<li class="sp-line">|</li>
            <li class="@isActiveMenu(MenuType.ISSUE)"><a href="@routes.IssueApp.issues(project.owner, project.name,"all")">@Messages("menu.issue")</a></li>
            <li class="sp-line">|</li>
			<li class="@isActiveMenu(MenuType.MILESTONE)"><a href="@routes.MilestoneApp.milestones(project.owner, project.name)">@Messages("project.milestone")</a></li>
		@if(ProjectUser.roleOf(session.get("loginId"), project).equals("manager")){
			<li class="sp-line">|</li>
			<li class="@isActiveMenu(MenuType.PROJECT_SETTING)"><a href="@routes.ProjectApp.settingForm(project.owner, project.name)">@Messages("menu.admin")</a></li>
		}
		</ul>
	</div>

@** 프로젝트 설정 서브메뉴 **@
@if(menuType.equals(MenuType.PROJECT_SETTING)){
	<div class="project-menu-wrap sub">
		<ul class="unstyled on-admin">
			@makeSubMenu(routes.ProjectApp.settingForm(project.owner, project.name),  Messages("project.setting"))
			@makeSubMenu(routes.ProjectApp.members(project.owner, project.name), 	  Messages("project.member"))
			@makeSubMenu(routes.ProjectApp.deleteForm(project.owner, project.name),   Messages("project.delete"))
		</ul>
	</div>
}
</div>

<script type="text/javascript">
$(document).ready(function(){
	// 프로젝트 전역 단축키: hive.ShortcutKey
    var htKeyMap = {
        "H": "@routes.ProjectApp.project(project.owner, project.name)",
        "B": "@routes.BoardApp.posts(project.owner, project.name)",
        "C": "@routes.CodeApp.codeBrowser(project.owner, project.name)",
        "I": "@routes.IssueApp.issues(project.owner, project.name,"all")",
        "M": "@routes.MilestoneApp.milestones(project.owner, project.name)"
    @if(project.vcs.equals("GIT")){
       ,"F": "@getPullRequestURL(project)"
    }
    @if(ProjectUser.roleOf(session.get("loginId"), project).equals("manager")){
       ,"Q": "@routes.ProjectApp.settingForm(project.owner, project.name)"
    }
    };

    hive.ShortcutKey.setKeymapLink(htKeyMap);
    $hive.loadModule("project.Watch");
});
</script>